<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WeatherRoutingTool.weather &#8212; WeatherRoutingTool  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for WeatherRoutingTool.weather</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Weather functions.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>

<span class="kn">import</span> <span class="nn">datacube</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">RegularGridInterpolator</span>

<span class="kn">import</span> <span class="nn">WeatherRoutingTool.utils.graphics</span> <span class="k">as</span> <span class="nn">graphics</span>
<span class="kn">import</span> <span class="nn">WeatherRoutingTool.utils.formatting</span> <span class="k">as</span> <span class="nn">form</span>
<span class="kn">from</span> <span class="nn">maridatadownloader</span> <span class="kn">import</span> <span class="n">DownloaderFactory</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.utils.maps</span> <span class="kn">import</span> <span class="n">Map</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.utils.unit_conversion</span> <span class="kn">import</span> <span class="p">(</span><span class="n">check_dataset_spacetime_consistency</span><span class="p">,</span> <span class="n">convert_nptd64_to_ints</span><span class="p">,</span>
                                                      <span class="n">round_time</span><span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;WRT.weather&#39;</span><span class="p">)</span>

<span class="n">UNITS_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Pressure_reduced_to_MSL_msl&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Pa&#39;</span><span class="p">],</span>
    <span class="s1">&#39;so&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;1e-3&#39;</span><span class="p">],</span>
    <span class="s1">&#39;Temperature_surface&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">],</span>
    <span class="s1">&#39;thetao&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;degrees_C&#39;</span><span class="p">,</span> <span class="s1">&#39;Â°C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">],</span>
    <span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">],</span>
    <span class="s1">&#39;utotal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">],</span>
    <span class="s1">&#39;vtotal&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">],</span>
    <span class="s1">&#39;VHM0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">],</span>
    <span class="s1">&#39;VMDR&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;degree&#39;</span><span class="p">],</span>
    <span class="s1">&#39;VTPK&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span>
<span class="p">}</span>


<div class="viewcode-block" id="WeatherCond">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCond">[docs]</a>
<span class="k">class</span> <span class="nc">WeatherCond</span><span class="p">:</span>
    <span class="n">time_steps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">time_res</span><span class="p">:</span> <span class="n">timedelta</span>
    <span class="n">time_start</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">time_end</span><span class="p">:</span> <span class="n">timedelta</span>
    <span class="n">map_size</span><span class="p">:</span> <span class="n">Map</span>
    <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">):</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_line</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initialising weather&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span> <span class="o">=</span> <span class="n">time_res</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">hours</span><span class="p">)</span>

        <span class="n">time_passed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_passed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;forecast from &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_start</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;nof time steps &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_line</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_res</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span>

    <span class="nd">@time_res</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">time_res</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Resolution below 3h not possible&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;time resolution: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_time_res</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; hours&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_start</span>

    <span class="nd">@time_start</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">time_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">rounded_time</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">rounded_time</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">rounded_time</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_res</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_start</span> <span class="o">=</span> <span class="n">rounded_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_end</span>

    <span class="nd">@time_end</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">time_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">rounded_time</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">rounded_time</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">rounded_time</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_res</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_time_end</span> <span class="o">=</span> <span class="n">rounded_time</span>

<div class="viewcode-block" id="WeatherCond.check_units">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCond.check_units">[docs]</a>
    <span class="k">def</span> <span class="nf">check_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">data_array</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">UNITS_DICT</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_array</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weather data variable &#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&#39; has no &#39;units&#39; attribute.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="n">data_array</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">UNITS_DICT</span><span class="p">[</span><span class="n">var_name</span><span class="p">]:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weather data variable &#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&#39; has the wrong unit &#39;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                                       <span class="sa">f</span><span class="s2">&quot;should be one of &#39;</span><span class="si">{</span><span class="n">UNITS_DICT</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weather data variable &#39;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&#39; found, but not expected. Will be ignored.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WeatherCond.set_map_size">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCond.set_map_size">[docs]</a>
    <span class="k">def</span> <span class="nf">set_map_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span> <span class="o">=</span> <span class="nb">map</span></div>


<div class="viewcode-block" id="WeatherCond.get_map_size">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCond.get_map_size">[docs]</a>
    <span class="k">def</span> <span class="nf">get_map_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span></div>


<div class="viewcode-block" id="WeatherCond.read_dataset">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCond.read_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="WeatherCondEnvAutomatic">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondEnvAutomatic">[docs]</a>
<span class="k">class</span> <span class="nc">WeatherCondEnvAutomatic</span><span class="p">(</span><span class="n">WeatherCond</span><span class="p">):</span>

    <span class="c1"># FIXME: add currents?</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">)</span>

<div class="viewcode-block" id="WeatherCondEnvAutomatic.check_data_consistency">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondEnvAutomatic.check_data_consistency">[docs]</a>
    <span class="k">def</span> <span class="nf">check_data_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds_CMEMS_phys</span><span class="p">,</span> <span class="n">ds_CMEMS_wave</span><span class="p">,</span> <span class="n">ds_CMEMS_curr</span><span class="p">,</span> <span class="n">ds_GFS</span><span class="p">):</span>
        <span class="c1">############################################</span>
        <span class="c1"># check time consistency</span>

        <span class="c1"># check time resolution and shifts</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_phys</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS physics&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_wave</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS waves&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_curr</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS currents&#39;</span><span class="p">)</span>

        <span class="c1"># hard asserts in case situation changes with respect to expected behaviour</span>
        <span class="n">time_wave</span> <span class="o">=</span> <span class="n">ds_CMEMS_wave</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">time_wind</span> <span class="o">=</span> <span class="n">ds_CMEMS_phys</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">time_curr</span> <span class="o">=</span> <span class="n">ds_CMEMS_curr</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">time_GFS</span> <span class="o">=</span> <span class="n">ds_GFS</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="n">time_wave_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">time_wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time_wind_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">time_wind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time_curr_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">time_curr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">time_GFS_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">time_GFS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">time_wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">time_wind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span>  <span class="c1"># CMEMS wave dataset contains 1 more time step than CMEMS physics</span>
        <span class="k">assert</span> <span class="n">time_wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">time_curr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span>  <span class="c1"># CMEMS current dataset contains 1 more time step than CMEMS physics</span>
        <span class="k">assert</span> <span class="n">time_wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">time_GFS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">itime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_wave</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">time_wave_sec</span><span class="p">[</span><span class="n">itime</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_nptd64_to_ints</span><span class="p">(</span><span class="n">time_wave</span><span class="p">[</span><span class="n">itime</span><span class="p">])</span>
        <span class="n">time_wave_sec</span> <span class="o">=</span> <span class="n">time_wave_sec</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="n">time_wave_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_wave_sec</span><span class="p">,</span> <span class="n">time_wave_sec</span><span class="p">[</span><span class="n">time_wave_sec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">itime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_wind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">time_wind_sec</span><span class="p">[</span><span class="n">itime</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_nptd64_to_ints</span><span class="p">(</span><span class="n">time_wind</span><span class="p">[</span><span class="n">itime</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">itime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_curr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">time_curr_sec</span><span class="p">[</span><span class="n">itime</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_nptd64_to_ints</span><span class="p">(</span><span class="n">time_curr</span><span class="p">[</span><span class="n">itime</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">itime</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_GFS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">time_GFS_sec</span><span class="p">[</span><span class="n">itime</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_nptd64_to_ints</span><span class="p">(</span><span class="n">time_GFS</span><span class="p">[</span><span class="n">itime</span><span class="p">])</span>
        <span class="n">time_GFS_sec</span> <span class="o">=</span> <span class="n">time_GFS_sec</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="n">time_GFS_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_GFS_sec</span><span class="p">,</span> <span class="n">time_GFS_sec</span><span class="p">[</span><span class="n">time_GFS_sec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>

        <span class="c1"># FIXME: these lines always throw an error; temporarily comment them until reviewed/fixed</span>
        <span class="c1"># assert np.array_equal(time_wind_sec, time_wave_sec)</span>
        <span class="c1"># assert np.array_equal(time_wind_sec, time_GFS_sec)</span>
        <span class="c1"># assert np.array_equal(time_wind_sec, time_curr_sec)</span>

        <span class="c1">############################################</span>
        <span class="c1"># check space consistency</span>

        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_phys</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS physics&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_wave</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS waves&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_curr</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS currents&#39;</span><span class="p">)</span>

        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_phys</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS physics&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_wave</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS waves&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">ds_CMEMS_curr</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;CMEMS currents&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WeatherCondEnvAutomatic.read_dataset">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondEnvAutomatic.read_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">CMEMS_product_wave</span> <span class="o">=</span> <span class="s1">&#39;cmems_mod_glo_wav_anfc_0.083deg_PT3H-i&#39;</span>
        <span class="n">CMEMS_product_wind</span> <span class="o">=</span> <span class="s1">&#39;cmems_mod_glo_phy_anfc_0.083deg_PT1H-m&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span>
            <span class="s1">&#39;Loading datasets from GFS and CMEMS (&#39;</span> <span class="o">+</span> <span class="n">CMEMS_product_wind</span> <span class="o">+</span> <span class="s1">&#39; and &#39;</span> <span class="o">+</span> <span class="n">CMEMS_product_wave</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">time_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">time_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>

        <span class="n">time_min_CMEMS_phys</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">time_max_CMEMS_phys</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">180</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>

        <span class="n">lon_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span>
        <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span>
        <span class="n">lat_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span>
        <span class="n">lat_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span>
        <span class="n">height_min</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">height_max</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="n">cmems_username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;CMEMS_USERNAME&#39;</span><span class="p">)</span>
        <span class="n">cmems_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;CMEMS_PASSWORD&#39;</span><span class="p">)</span>

        <span class="c1"># download GFS data</span>
        <span class="n">par_GFS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Temperature_surface&quot;</span><span class="p">,</span> <span class="s2">&quot;u-component_of_wind_height_above_ground&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;v-component_of_wind_height_above_ground&quot;</span><span class="p">,</span> <span class="s2">&quot;Pressure_reduced_to_MSL_msl&quot;</span><span class="p">]</span>
        <span class="n">sel_dict_GFS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">),</span> <span class="s1">&#39;time1&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">),</span>
                        <span class="s1">&#39;height_above_ground2&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">height_min</span><span class="p">,</span> <span class="n">height_max</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span>
                        <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">)}</span>

        <span class="n">downloader_gfs</span> <span class="o">=</span> <span class="n">DownloaderFactory</span><span class="o">.</span><span class="n">get_downloader</span><span class="p">(</span><span class="s1">&#39;xarray&#39;</span><span class="p">,</span> <span class="s1">&#39;gfs&#39;</span><span class="p">)</span>
        <span class="n">ds_GFS</span> <span class="o">=</span> <span class="n">downloader_gfs</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">par_GFS</span><span class="p">,</span> <span class="n">sel_dict_GFS</span><span class="p">)</span>

        <span class="c1"># download CMEMS wave data</span>
        <span class="n">par_CMEMS_wave</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;VMDR&quot;</span><span class="p">,</span> <span class="s2">&quot;VHM0&quot;</span><span class="p">,</span> <span class="s2">&quot;VTPK&quot;</span><span class="p">]</span>
        <span class="n">sel_dict_CMEMS_wave</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">),</span> <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span>
                               <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">)}</span>
        <span class="n">downloader_cmems_wave</span> <span class="o">=</span> <span class="n">DownloaderFactory</span><span class="o">.</span><span class="n">get_downloader</span><span class="p">(</span><span class="n">downloader_type</span><span class="o">=</span><span class="s1">&#39;cmtapi&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cmems&#39;</span><span class="p">,</span>
                                                                 <span class="n">product</span><span class="o">=</span><span class="s1">&#39;cmems_mod_glo_wav_anfc_0.083deg_PT3H-i&#39;</span><span class="p">,</span>
                                                                 <span class="n">product_type</span><span class="o">=</span><span class="s1">&#39;nrt&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">cmems_username</span><span class="p">,</span>
                                                                 <span class="n">password</span><span class="o">=</span><span class="n">cmems_password</span><span class="p">)</span>
        <span class="n">ds_CMEMS_wave</span> <span class="o">=</span> <span class="n">downloader_cmems_wave</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">par_CMEMS_wave</span><span class="p">,</span> <span class="n">sel_dict</span><span class="o">=</span><span class="n">sel_dict_CMEMS_wave</span><span class="p">)</span>

        <span class="c1"># download CMEMS physics data</span>
        <span class="n">par_CMEMS_phys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;thetao&quot;</span><span class="p">,</span> <span class="s2">&quot;so&quot;</span><span class="p">]</span>
        <span class="n">sel_dict_CMEMS_phys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">time_min_CMEMS_phys</span><span class="p">,</span> <span class="n">time_max_CMEMS_phys</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                               <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">)}</span>
        <span class="n">downloader_cmems_phys</span> <span class="o">=</span> <span class="n">DownloaderFactory</span><span class="o">.</span><span class="n">get_downloader</span><span class="p">(</span><span class="n">downloader_type</span><span class="o">=</span><span class="s1">&#39;cmtapi&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cmems&#39;</span><span class="p">,</span>
                                                                 <span class="n">product</span><span class="o">=</span><span class="s1">&#39;cmems_mod_glo_phy_anfc_0.083deg_PT1H-m&#39;</span><span class="p">,</span>
                                                                 <span class="n">product_type</span><span class="o">=</span><span class="s1">&#39;nrt&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">cmems_username</span><span class="p">,</span>
                                                                 <span class="n">password</span><span class="o">=</span><span class="n">cmems_password</span><span class="p">)</span>
        <span class="n">ds_CMEMS_phys</span> <span class="o">=</span> <span class="n">downloader_cmems_phys</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">par_CMEMS_phys</span><span class="p">,</span> <span class="n">sel_dict</span><span class="o">=</span><span class="n">sel_dict_CMEMS_phys</span><span class="p">)</span>

        <span class="c1"># download CMEMS current data</span>
        <span class="n">par_CMEMS_curr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;vtotal&quot;</span><span class="p">,</span> <span class="s2">&quot;utotal&quot;</span><span class="p">]</span>
        <span class="n">sel_dict_CMEMS_curr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">time_min_CMEMS_phys</span><span class="p">,</span> <span class="n">time_max_CMEMS_phys</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                               <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">)}</span>
        <span class="n">downloader_cmems_curr</span> <span class="o">=</span> <span class="n">DownloaderFactory</span><span class="o">.</span><span class="n">get_downloader</span><span class="p">(</span><span class="n">downloader_type</span><span class="o">=</span><span class="s1">&#39;cmtapi&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;cmems&#39;</span><span class="p">,</span>
                                                                 <span class="n">product</span><span class="o">=</span><span class="s1">&#39;cmems_mod_glo_phy_anfc_merged-uv_PT1H-i&#39;</span><span class="p">,</span>
                                                                 <span class="n">product_type</span><span class="o">=</span><span class="s1">&#39;nrt&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">cmems_username</span><span class="p">,</span>
                                                                 <span class="n">password</span><span class="o">=</span><span class="n">cmems_password</span><span class="p">)</span>
        <span class="n">ds_CMEMS_curr</span> <span class="o">=</span> <span class="n">downloader_cmems_curr</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">par_CMEMS_curr</span><span class="p">,</span> <span class="n">sel_dict</span><span class="o">=</span><span class="n">sel_dict_CMEMS_curr</span><span class="p">)</span>

        <span class="c1"># convert latitudes of GFS data</span>
        <span class="n">GFS_lat</span> <span class="o">=</span> <span class="n">ds_GFS</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">GFS_lat</span><span class="p">[</span><span class="n">GFS_lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">GFS_lat</span><span class="p">[</span><span class="n">GFS_lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span>

        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;weather request:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_data_consistency</span><span class="p">(</span><span class="n">ds_CMEMS_phys</span><span class="p">,</span> <span class="n">ds_CMEMS_wave</span><span class="p">,</span> <span class="n">ds_CMEMS_curr</span><span class="p">,</span> <span class="n">ds_GFS</span><span class="p">)</span>

        <span class="c1"># interpolate CMEMS wave data to timestamps of CMEMS physics and merge</span>
        <span class="n">phys_interpolated</span> <span class="o">=</span> <span class="n">ds_CMEMS_phys</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">ds_CMEMS_wave</span><span class="p">)</span>
        <span class="n">curr_interpolated</span> <span class="o">=</span> <span class="n">ds_CMEMS_curr</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">ds_CMEMS_wave</span><span class="p">)</span>
        <span class="n">full_CMEMS_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">curr_interpolated</span><span class="p">,</span> <span class="n">phys_interpolated</span><span class="p">,</span> <span class="n">ds_CMEMS_wave</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;CMEMS merge&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="c1"># interpolate GFS data to lat/lon resolution of CMEMS full data and merge</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;Full CMEMS&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;Full CMEMS&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;Full CMEMS&#39;</span><span class="p">)</span>

        <span class="n">GFS_interpolated</span> <span class="o">=</span> <span class="n">ds_GFS</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">full_CMEMS_data</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;interpolation&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="n">GFS_interpolated</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;end time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span></div>


<div class="viewcode-block" id="WeatherCondEnvAutomatic.write_data">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondEnvAutomatic.write_data">[docs]</a>
    <span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="c1"># time_str_start = self.time_start.strftime(&quot;%Y-%m-%d-%H&quot;)</span>
        <span class="c1"># time_str_end = self.time_end.strftime(&quot;%Y-%m-%d-%H&quot;)</span>

        <span class="c1"># filename = str(time_str_start) + &#39;_&#39; + str(time_str_end) + &#39;_&#39; + str(self.map_size.lat1) + &#39;_&#39; + str(</span>
        <span class="c1">#    self.map_size.lon1) + &#39;_&#39; + str(self.map_size.lat2) + &#39;_&#39; + str(self.map_size.lon2) + &#39;.nc&#39;</span>
        <span class="c1"># full_path = filepath + &#39;/&#39; + filename</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing weather data to file &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">filepath</span></div>
</div>



<div class="viewcode-block" id="WeatherCondFromFile">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile">[docs]</a>
<span class="k">class</span> <span class="nc">WeatherCondFromFile</span><span class="p">(</span><span class="n">WeatherCond</span><span class="p">):</span>
    <span class="n">wind_functions</span><span class="p">:</span> <span class="kc">None</span>
    <span class="n">wind_vectors</span><span class="p">:</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">)</span>

<div class="viewcode-block" id="WeatherCondFromFile.calculate_wind_function">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.calculate_wind_function">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_wind_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="c1"># print(&#39;Reading time&#39;, time_str)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time_str</span><span class="p">,</span> <span class="n">height_above_ground2</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time_str</span><span class="p">,</span> <span class="n">height_above_ground2</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;time: &#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;time string: &#39;</span><span class="p">,</span> <span class="n">time_str</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Please make sure that time stamps of environmental data match full hours: time = &#39;</span> <span class="o">+</span> <span class="n">time_str</span><span class="p">)</span>

        <span class="n">twa</span><span class="p">,</span> <span class="n">tws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_twatws_from_uv</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">tws</span> <span class="o">=</span> <span class="n">tws</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">twa</span> <span class="o">=</span> <span class="n">twa</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;twa&#39;</span><span class="p">:</span> <span class="n">twa</span><span class="p">,</span> <span class="s1">&#39;tws&#39;</span><span class="p">:</span> <span class="n">tws</span><span class="p">}</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.read_wind_functions">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.read_wind_functions">[docs]</a>
    <span class="k">def</span> <span class="nf">read_wind_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iTime</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span> <span class="o">*</span> <span class="n">iTime</span>
        <span class="c1"># wind = self.nc_to_wind_function_old_format()</span>
        <span class="n">wind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_wind_function</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">wind</span><span class="p">[</span><span class="s1">&#39;twa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">wind</span><span class="p">[</span><span class="s1">&#39;tws&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Shape of twa and tws not matching!&#39;</span><span class="p">)</span>

        <span class="n">lat_shape</span> <span class="o">=</span> <span class="n">wind</span><span class="p">[</span><span class="s1">&#39;twa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lon_shape</span> <span class="o">=</span> <span class="n">wind</span><span class="p">[</span><span class="s1">&#39;twa&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lats_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span><span class="p">,</span> <span class="n">lat_shape</span><span class="p">)</span>
        <span class="n">lons_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span><span class="p">,</span> <span class="n">lon_shape</span><span class="p">)</span>

        <span class="n">f_twa</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="n">lats_grid</span><span class="p">,</span> <span class="n">lons_grid</span><span class="p">),</span> <span class="n">wind</span><span class="p">[</span><span class="s1">&#39;twa&#39;</span><span class="p">],</span> <span class="p">)</span>

        <span class="n">f_tws</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="n">lats_grid</span><span class="p">,</span> <span class="n">lons_grid</span><span class="p">),</span> <span class="n">wind</span><span class="p">[</span><span class="s1">&#39;tws&#39;</span><span class="p">],</span> <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;twa&#39;</span><span class="p">:</span> <span class="n">f_twa</span><span class="p">,</span> <span class="s1">&#39;tws&#39;</span><span class="p">:</span> <span class="n">f_tws</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">}</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.read_wind_vectors">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.read_wind_vectors">[docs]</a>
    <span class="k">def</span> <span class="nf">read_wind_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return u-v components for given rect for visualization.&quot;&quot;&quot;</span>

        <span class="n">lat1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span>
        <span class="n">lon2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>

        <span class="n">ds_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time_str</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">ds_time</span><span class="p">[</span><span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;=</span> <span class="n">lat1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&lt;=</span> <span class="n">lat2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&gt;=</span> <span class="n">lon1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="n">ds_time</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&lt;=</span> <span class="n">lon2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">height_above_ground2</span> <span class="o">==</span> <span class="mi">10</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ds_time</span><span class="p">[</span><span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;=</span> <span class="n">lat1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&lt;=</span> <span class="n">lat2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&gt;=</span> <span class="n">lon1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="n">ds_time</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&lt;=</span> <span class="n">lon2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">height_above_ground2</span> <span class="o">==</span> <span class="mi">10</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">lats_u_1D</span> <span class="o">=</span> <span class="n">ds_time</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_time</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;=</span> <span class="n">lat1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&lt;=</span> <span class="n">lat2</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">lons_u_1D</span> <span class="o">=</span> <span class="n">ds_time</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_time</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&gt;=</span> <span class="n">lon1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_time</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&lt;=</span> <span class="n">lon2</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">lats_u_1D</span> <span class="o">=</span> <span class="n">lats_u_1D</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">lons_u_1D</span> <span class="o">=</span> <span class="n">lons_u_1D</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">lats_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">lats_u_1D</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lons_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">lons_u_1D</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="s1">&#39;lats_u&#39;</span><span class="p">:</span> <span class="n">lats_u</span><span class="p">,</span> <span class="s1">&#39;lons_u&#39;</span><span class="p">:</span> <span class="n">lons_u</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">}</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.plot_weather_map">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.plot_weather_map">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_weather_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">rebinx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">rebiny</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;wind&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">VHM0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">height_above_ground</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span><span class="p">),</span>
                <span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">VHM0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">height_above_ground</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span><span class="p">),</span>
                <span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">rebinx</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">rebiny</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s2">&quot;trim&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">rebinx</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">rebiny</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s2">&quot;trim&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

            <span class="n">windspeed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">windspeed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;wind speed and direction at </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;latitude (Â°N)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;longitude (Â°W)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">windspeed</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">windspeed</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="c1"># plt.quiver(x, y, u.values, v.values, clim=[0, 20])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">barbs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;waveheight&#39;</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VHM0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">height</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="n">h</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;wave heigh&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;current&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;latitude (Â°N)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;longitude (Â°W)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;uo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># u = u[::3, ::6]</span>
            <span class="c1"># v = u[::3, ::6]</span>

            <span class="n">unp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">vnp</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="n">unp</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="n">unp</span><span class="p">,</span> <span class="n">rebinx</span><span class="p">,</span> <span class="n">rebiny</span><span class="p">)</span>
            <span class="n">vnp</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">rebin</span><span class="p">(</span><span class="n">vnp</span><span class="p">,</span> <span class="n">rebinx</span><span class="p">,</span> <span class="n">rebiny</span><span class="p">)</span>

            <span class="n">windspeed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">windspeed</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;current&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;latitude (Â°N)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;longitude (Â°W)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">windspeed</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">windspeed</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="c1"># plt.barbs(x, y, u.values, v.values)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;wavedir&#39;</span><span class="p">:</span>
            <span class="n">wavedir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VMDR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
            <span class="n">waveheight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VHM0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wavedir</span><span class="p">)</span> <span class="o">*</span> <span class="n">waveheight</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wavedir</span><span class="p">)</span> <span class="o">*</span> <span class="n">waveheight</span>

            <span class="n">h</span> <span class="o">=</span> <span class="n">waveheight</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="c1"># h.set_clim(0, 0.6)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;current&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;latitude (Â°N)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;longitude (Â°W)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">waveheight</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">waveheight</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="c1"># plt.barbs(x, y, u.values, v.values)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.close_env_file">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.close_env_file">[docs]</a>
    <span class="k">def</span> <span class="nf">close_env_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.adjust_depth_format">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.adjust_depth_format">[docs]</a>
    <span class="k">def</span> <span class="nf">adjust_depth_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth_path</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ds_depth</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">depth_path</span><span class="p">)</span>
        <span class="n">ds_depth</span> <span class="o">=</span> <span class="n">ds_depth</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">)</span>
        <span class="n">ds_depth</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">ds_depth_pos</span> <span class="o">=</span> <span class="n">ds_depth</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_depth</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ds_depth_neg</span> <span class="o">=</span> <span class="n">ds_depth</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_depth</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ds_depth_neg</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_depth_neg</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>
        <span class="n">ds_depth</span> <span class="o">=</span> <span class="n">ds_depth_pos</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_depth_neg</span><span class="p">)</span>

        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ds_depth_pos&#39;</span><span class="p">,</span> <span class="n">ds_depth_pos</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ds_depth_neg&#39;</span><span class="p">,</span> <span class="n">ds_depth_neg</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ds_depth new&#39;</span><span class="p">,</span> <span class="n">ds_depth</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ds_depth</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.add_depth_to_EnvData">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.add_depth_to_EnvData">[docs]</a>
    <span class="k">def</span> <span class="nf">add_depth_to_EnvData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth_path</span><span class="p">,</span> <span class="n">bWriteEnvData</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lat_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span>
            <span class="n">lat_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span>
            <span class="n">lon_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span>
            <span class="n">lon_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Need to initialise weather data bounding box before adding depth data!&#39;</span><span class="p">)</span>

        <span class="n">ds_depth</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">depth_path</span><span class="p">)</span>
        <span class="n">ds_depth</span> <span class="o">=</span> <span class="n">ds_depth</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_depth</span><span class="o">.</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">lat_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_depth</span><span class="o">.</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">lat_end</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_depth</span><span class="o">.</span><span class="n">lon</span> <span class="o">&gt;</span> <span class="n">lon_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">ds_depth</span><span class="o">.</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="n">lon_end</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_depth</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">ds_depth</span> <span class="o">=</span> <span class="n">ds_depth</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">)</span>
        <span class="n">weather_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">ds_depth</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>

        <span class="n">depth</span> <span class="o">=</span> <span class="n">ds_depth</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>

        <span class="n">weather_int</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">depth</span><span class="p">)</span>
        <span class="n">depth_test</span> <span class="o">=</span> <span class="n">weather_int</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">depth_test</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;depth_test:&#39;</span><span class="p">,</span> <span class="n">depth_test</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;element of depth is nan!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">weather_int</span>

        <span class="k">if</span> <span class="n">bWriteEnvData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span>
                <span class="s1">&#39;/home/kdemmich/MariData/Code/MariGeoRoute/Isochrone/Data/Depth_u_EnvData/EnvData_Depth.nc&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.get_time_step_index">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.get_time_step_index">[docs]</a>
    <span class="k">def</span> <span class="nf">get_time_step_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="n">rounded_time</span> <span class="o">=</span> <span class="n">round_time</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_res</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
        <span class="n">time_passed</span> <span class="o">=</span> <span class="n">rounded_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_passed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;rounded_time&#39;</span><span class="p">:</span> <span class="n">rounded_time</span><span class="p">,</span> <span class="s1">&#39;idx&#39;</span><span class="p">:</span> <span class="n">idx</span><span class="p">}</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.manipulate_dataset">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.manipulate_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">manipulate_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># condition =  4</span>
        <span class="c1"># lat = 54.608889</span>
        <span class="c1"># lon = 6.179722</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="mf">55.048333</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="mf">5.130000</span>

        <span class="c1"># condition = 4</span>
        <span class="c1"># condition = 8</span>

        <span class="n">dim</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">-</span> <span class="n">dim</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">dim</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">lat</span> <span class="o">-</span> <span class="n">dim</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">lat</span> <span class="o">+</span> <span class="n">dim</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;before: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;VHM0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;VHM0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">condition</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;after: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;VHM0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;/home/kdemmich/MariData/Simulationsstudie_April23/manipulated_data.nc&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.get_twatws_from_uv">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.get_twatws_from_uv">[docs]</a>
    <span class="k">def</span> <span class="nf">get_twatws_from_uv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">tws</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">twa</span> <span class="o">=</span> <span class="mf">180.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="mf">180.0</span>  <span class="c1"># angle from 0Â° to 360Â°, 0Â° = N</span>
        <span class="k">return</span> <span class="n">twa</span><span class="p">,</span> <span class="n">tws</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.init_wind_vectors">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.init_wind_vectors">[docs]</a>
    <span class="k">def</span> <span class="nf">init_wind_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return wind vectors for given number of hours.</span>
<span class="sd">            Parameters:</span>
<span class="sd">                    model (dict): available forecast wind functions</span>
<span class="sd">                    hours_ahead (int): number of hours looking ahead</span>
<span class="sd">                    lats, lons: rectange defining forecast area</span>
<span class="sd">            Returns:</span>
<span class="sd">                    wind_vectors (dict):</span>
<span class="sd">                        model: model timestamp</span>
<span class="sd">                        hour: function for given forecast hour</span>
<span class="sd">            &quot;&quot;&quot;</span>

        <span class="n">wind_vectors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">wind_vectors</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">):</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">wind_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_wind_vectors</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>  <span class="c1"># print(&#39;reading wind vector time&#39;, time)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wind_vectors</span> <span class="o">=</span> <span class="n">wind_vectors</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.get_wind_vector">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.get_wind_vector">[docs]</a>
    <span class="k">def</span> <span class="nf">get_wind_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="n">time_passed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_time_step_index</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">rounded_time</span> <span class="o">=</span> <span class="n">time_passed</span><span class="p">[</span><span class="s1">&#39;rounded_time&#39;</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">time_passed</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">wind_timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_vectors</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Requesting weather data for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; at index &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; but only &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; available&#39;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rounded_time</span> <span class="o">==</span> <span class="n">wind_timestamp</span><span class="p">):</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="s1">&#39;Accessing wrong weather forecast. Accessing element &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wind_vectors</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; but current rounded time is &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rounded_time</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_vectors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>


<div class="viewcode-block" id="WeatherCondFromFile.read_dataset">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondFromFile.read_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;filepath must not be None for data_mode = &#39;from_file&#39;&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;Reading dataset from&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>  <span class="c1"># self.ds = self.manipulate_dataset()</span></div>
</div>



<div class="viewcode-block" id="WeatherCondODC">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondODC">[docs]</a>
<span class="k">class</span> <span class="nc">WeatherCondODC</span><span class="p">(</span><span class="n">WeatherCond</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dc</span> <span class="o">=</span> <span class="n">datacube</span><span class="o">.</span><span class="n">Datacube</span><span class="p">()</span>

<div class="viewcode-block" id="WeatherCondODC.load_odc_product">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondODC.load_odc_product">[docs]</a>
    <span class="k">def</span> <span class="nf">load_odc_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">product_name</span><span class="p">,</span> <span class="n">res_x</span><span class="p">,</span> <span class="n">res_y</span><span class="p">,</span> <span class="n">output_crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">measurements</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">product_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">list_products</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product_name</span><span class="si">}</span><span class="s2"> is not known in the Open Data Cube instance&quot;</span><span class="p">)</span>

            <span class="n">time_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">time_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>

            <span class="n">lon_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span>
            <span class="n">lon_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span>
            <span class="n">lat_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span>
            <span class="n">lat_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span>

            <span class="k">if</span> <span class="n">measurements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">measurements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">list_measurements</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">product_name</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check if requested measurements are available in ODC (measurements or aliases)</span>
                <span class="n">measurements_odc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">list_measurements</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">product_name</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">aliases_odc</span> <span class="o">=</span> <span class="p">[</span><span class="n">alias</span> <span class="k">for</span> <span class="n">aliases_per_var</span> <span class="ow">in</span>
                               <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">list_measurements</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">product_name</span><span class="p">][</span><span class="s1">&#39;aliases&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span>
                               <span class="n">aliases_per_var</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">measurement</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">measurements_odc</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">measurement</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aliases_odc</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">measurement</span><span class="si">}</span><span class="s2"> is not a valid measurement for odc product </span><span class="si">{</span><span class="n">product_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># FIXME: is the order (res_x, res_y) correct in resolution and align?</span>
            <span class="c1"># FIXME: do we need a minus sign for res_x?</span>
            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">res_x</span><span class="p">,</span> <span class="n">res_y</span><span class="p">),</span> <span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">res_x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">res_y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span>
                     <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">),</span> <span class="s1">&#39;output_crs&#39;</span><span class="p">:</span> <span class="n">output_crs</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">),</span>
                     <span class="s1">&#39;measurements&#39;</span><span class="p">:</span> <span class="n">measurements</span><span class="p">}</span>
            <span class="n">ds_datacube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">product_name</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>
            <span class="c1"># Apply scale_factor and offset if necessary (needs to be done explicitly as ODC is only setting</span>
            <span class="c1"># the attributes)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_scaling</span><span class="p">(</span><span class="n">ds_datacube</span><span class="p">):</span>
                <span class="n">ds_datacube</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">(</span><span class="n">ds_datacube</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ds_datacube</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span></div>


<div class="viewcode-block" id="WeatherCondODC.read_dataset">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondODC.read_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># ODC doesn&#39;t allow hyphens (&quot;-&quot;) in band names. Because we would like to keep the original band</span>
        <span class="c1"># names from GFS with hyphen we use band aliases instead.</span>
        <span class="n">measurements_gfs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Temperature_surface&#39;</span><span class="p">,</span> <span class="s1">&#39;Pressure_reduced_to_MSL_msl&#39;</span><span class="p">,</span> <span class="s1">&#39;Wind_speed_gust_surface&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">,</span> <span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">]</span>

        <span class="n">ds_CMEMS_phys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_odc_product</span><span class="p">(</span><span class="s1">&#39;physics&#39;</span><span class="p">,</span> <span class="n">res_x</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="n">res_y</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">ds_CMEMS_wave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_odc_product</span><span class="p">(</span><span class="s1">&#39;waves&#39;</span><span class="p">,</span> <span class="n">res_x</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="n">res_y</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">ds_CMEMS_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_odc_product</span><span class="p">(</span><span class="s1">&#39;currents&#39;</span><span class="p">,</span> <span class="n">res_x</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="n">res_y</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">ds_GFS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_odc_product</span><span class="p">(</span><span class="s1">&#39;weather&#39;</span><span class="p">,</span> <span class="n">res_x</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">res_y</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">measurements</span><span class="o">=</span><span class="n">measurements_gfs</span><span class="p">)</span>

        <span class="c1"># form.print_current_time(&#39;time after weather request:&#39;, time.time())</span>
        <span class="c1"># self.check_data_consistency(ds_CMEMS_phys, ds_CMEMS_wave, ds_GFS)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;weather checks:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="c1"># interpolate CMEMS wave data to timestamps of CMEMS physics and merge</span>
        <span class="n">phys_interpolated</span> <span class="o">=</span> <span class="n">ds_CMEMS_phys</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">ds_CMEMS_wave</span><span class="p">)</span>
        <span class="n">curr_interpolated</span> <span class="o">=</span> <span class="n">ds_CMEMS_curr</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">ds_CMEMS_wave</span><span class="p">)</span>
        <span class="n">full_CMEMS_data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">curr_interpolated</span><span class="p">,</span> <span class="n">phys_interpolated</span><span class="p">,</span> <span class="n">ds_CMEMS_wave</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;CMEMS merge&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="c1"># interpolate GFS data to lat/lon resolution of CMEMS full data and merge</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;Full CMEMS&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;Full CMEMS&#39;</span><span class="p">)</span>
        <span class="n">check_dataset_spacetime_consistency</span><span class="p">(</span><span class="n">ds_GFS</span><span class="p">,</span> <span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;GFS&#39;</span><span class="p">,</span> <span class="s1">&#39;Full CMEMS&#39;</span><span class="p">)</span>

        <span class="n">GFS_interpolated</span> <span class="o">=</span> <span class="n">ds_GFS</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">full_CMEMS_data</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;interpolation&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">full_CMEMS_data</span><span class="p">,</span> <span class="n">GFS_interpolated</span><span class="p">])</span>
        <span class="n">form</span><span class="o">.</span><span class="n">print_current_time</span><span class="p">(</span><span class="s1">&#39;end time&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span></div>


<div class="viewcode-block" id="WeatherCondODC.write_data">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.WeatherCondODC.write_data">[docs]</a>
    <span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing weather data to file &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">filepath</span></div>


    <span class="k">def</span> <span class="nf">_has_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if any of the included data variables has a scale_factor or add_offset&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;scale_factor&#39;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="ow">or</span> <span class="s1">&#39;add_offset&#39;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
        <span class="c1"># FIXME: decode_cf also scales the nodata values, e.g. -32767 -&gt; -327.67</span>
        <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">decode_cf</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span></div>



<div class="viewcode-block" id="FakeWeather">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.FakeWeather">[docs]</a>
<span class="k">class</span> <span class="nc">FakeWeather</span><span class="p">(</span><span class="n">WeatherCond</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">,</span> <span class="n">coord_res</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">var_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">time_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">var_list_zero</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;vtotal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;utotal&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;thetao&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;so&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;VMDR&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VHM0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;VTPK&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;Temperature_surface&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;Pressure_reduced_to_MSL_msl&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_res</span> <span class="o">=</span> <span class="n">coord_res</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">combine_var_dicts</span><span class="p">(</span><span class="n">var_dict_manual</span><span class="o">=</span><span class="n">var_dict</span><span class="p">,</span> <span class="n">var_dict_zero</span><span class="o">=</span><span class="n">var_list_zero</span><span class="p">)</span>

<div class="viewcode-block" id="FakeWeather.combine_var_dicts">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.FakeWeather.combine_var_dicts">[docs]</a>
    <span class="k">def</span> <span class="nf">combine_var_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_dict_manual</span><span class="p">,</span> <span class="n">var_dict_zero</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">var_dict_manual</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span> <span class="o">=</span> <span class="n">var_dict_zero</span> <span class="o">|</span> <span class="n">var_dict_manual</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span> <span class="o">=</span> <span class="n">var_dict_zero</span></div>


<div class="viewcode-block" id="FakeWeather.read_dataset">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.FakeWeather.read_dataset">[docs]</a>
    <span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># initialise coordinates</span>
        <span class="c1"># round differences to 10^-5 (~1 m for latitude) to prevent shifts due to floating numbers</span>
        <span class="c1"># interpret the configured map size limits inclusive</span>
        <span class="n">n_lat_values</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_res</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">lat_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span>
        <span class="n">lat_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_res</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_lat_values</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lat_start</span><span class="p">,</span> <span class="n">lat_end</span><span class="p">,</span> <span class="n">n_lat_values</span><span class="p">)</span>

        <span class="n">n_lon_values</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_res</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">lon_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span>
        <span class="n">lon_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_res</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_lon_values</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lon_start</span><span class="p">,</span> <span class="n">lon_end</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">)</span>

        <span class="n">n_time_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">start_time_sec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="n">end_time_sec</span> <span class="o">=</span> <span class="n">start_time_sec</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_res</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">time_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_time_sec</span><span class="p">,</span> <span class="n">end_time_sec</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">time_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">):</span>
            <span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time_space</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">n_depth_values</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.494</span><span class="p">])</span>

        <span class="c1"># initialise variables</span>
        <span class="n">vtotal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">,</span> <span class="n">n_depth_values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;vtotal&#39;</span><span class="p">])</span>
        <span class="n">utotal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">,</span> <span class="n">n_depth_values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;utotal&#39;</span><span class="p">])</span>
        <span class="n">thetao</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">,</span> <span class="n">n_depth_values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;thetao&#39;</span><span class="p">])</span>
        <span class="n">so</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">,</span> <span class="n">n_depth_values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;so&#39;</span><span class="p">])</span>

        <span class="n">VMDR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;VMDR&#39;</span><span class="p">])</span>
        <span class="n">VHM0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;VHM0&#39;</span><span class="p">])</span>
        <span class="n">VTPK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;VTPK&#39;</span><span class="p">])</span>
        <span class="n">Temperature_surface</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;Temperature_surface&#39;</span><span class="p">])</span>

        <span class="n">uwind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">])</span>
        <span class="n">vwind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">])</span>

        <span class="n">Pressure_reduced_to_MSL_msl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_lat_values</span><span class="p">,</span> <span class="n">n_lon_values</span><span class="p">,</span> <span class="n">n_time_values</span><span class="p">),</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">var_dict</span><span class="p">[</span><span class="s1">&#39;Pressure_reduced_to_MSL_msl&#39;</span><span class="p">])</span>

        <span class="c1"># create dataset</span>
        <span class="n">data_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vtotal</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">],</span> <span class="n">vtotal</span><span class="p">),</span>
                         <span class="n">utotal</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">],</span> <span class="n">utotal</span><span class="p">),</span>
                         <span class="n">thetao</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">],</span> <span class="n">thetao</span><span class="p">),</span>
                         <span class="n">so</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;depth&quot;</span><span class="p">],</span> <span class="n">so</span><span class="p">),</span>

                         <span class="n">VMDR</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">VMDR</span><span class="p">),</span>
                         <span class="n">VHM0</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">VHM0</span><span class="p">),</span>
                         <span class="n">VTPK</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">VTPK</span><span class="p">),</span>
                         <span class="n">Temperature_surface</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">Temperature_surface</span><span class="p">),</span>

                         <span class="n">uwind</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">uwind</span><span class="p">),</span>
                         <span class="n">vwind</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">vwind</span><span class="p">),</span>

                         <span class="n">Pressure_reduced_to_MSL_msl</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">Pressure_reduced_to_MSL_msl</span><span class="p">),</span>
                         <span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">lat</span><span class="p">),</span> <span class="n">longitude</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">lon</span><span class="p">),</span> <span class="n">time</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">time</span><span class="p">),</span>
                      <span class="n">depth</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span> <span class="n">depth</span><span class="p">))</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Necessary descriptions added here.&quot;</span><span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vtotal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vtotal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;m s-1&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;utotal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;utotal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;m s-1&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;thetao&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;thetao&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;degrees_C&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;so&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;so&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;1e-3&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VMDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VMDR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;degree&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VHM0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VHM0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VTPK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;VTPK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_surface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Temperature_surface&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;uwind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;uwind&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vwind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vwind&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Pressure_reduced_to_MSL_msl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;Pressure_reduced_to_MSL_msl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;uwind&#39;</span><span class="p">:</span> <span class="s1">&#39;u-component_of_wind_height_above_ground&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;vwind&#39;</span><span class="p">:</span> <span class="s1">&#39;v-component_of_wind_height_above_ground&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span></div>


<div class="viewcode-block" id="FakeWeather.write_data">
<a class="viewcode-back" href="../../source/api-documentation/WeatherRoutingTool.html#WeatherRoutingTool.weather.FakeWeather.write_data">[docs]</a>
    <span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing weather data to file &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">filepath</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">WeatherRoutingTool</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/algorithms/index.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/constraints/index.html">Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/consumption-models/index.html">Consumption models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/weather.html">Weather data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/api-documentation/index.html">API documentation (still under construction!)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/uml.html">UML Class diagrams</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, 52Â°North Spatial Information Research GmbH.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>