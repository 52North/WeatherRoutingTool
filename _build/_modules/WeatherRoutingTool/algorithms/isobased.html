<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WeatherRoutingTool.algorithms.isobased &#8212; WeatherRoutingTool  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for WeatherRoutingTool.algorithms.isobased</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">geovectorslib</span> <span class="kn">import</span> <span class="n">geod</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binned_statistic</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>

<span class="kn">import</span> <span class="nn">WeatherRoutingTool.utils.formatting</span> <span class="k">as</span> <span class="nn">form</span>
<span class="kn">import</span> <span class="nn">WeatherRoutingTool.utils.graphics</span> <span class="k">as</span> <span class="nn">graphics</span>
<span class="kn">import</span> <span class="nn">WeatherRoutingTool.utils.unit_conversion</span> <span class="k">as</span> <span class="nn">units</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.algorithms.routingalg</span> <span class="kn">import</span> <span class="n">RoutingAlg</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.constraints.constraints</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.routeparams</span> <span class="kn">import</span> <span class="n">RouteParams</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.ship.ship</span> <span class="kn">import</span> <span class="n">Boat</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.ship.shipparams</span> <span class="kn">import</span> <span class="n">ShipParams</span>
<span class="kn">from</span> <span class="nn">WeatherRoutingTool.weather</span> <span class="kn">import</span> <span class="n">WeatherCond</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;WRT.Isobased&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="IsoBased">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased">[docs]</a>
<span class="k">class</span> <span class="nc">IsoBased</span><span class="p">(</span><span class="n">RoutingAlg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    All variables that are named *_per_step constitute (M,N) arrays, whereby N corresponds to the number of</span>
<span class="sd">    courses (plus 1) and M corresponds to the number of routing steps.</span>
<span class="sd">    At the start of each routing step &#39;count&#39;, the element(s) at the position &#39;count&#39; of the following arrays</span>
<span class="sd">    correspond to properties of the point of departure of the respective routing step. This means that</span>
<span class="sd">    for &#39;count = 0&#39; the elements of lats_per_step and lons_per_step correspond to the coordinates of the</span>
<span class="sd">    departure point of the whole route. The first elements of the attributes</span>
<span class="sd">     - course_per_step</span>
<span class="sd">     - dist_per_step</span>
<span class="sd">     - speed_per_step</span>
<span class="sd">    are 0 to satisfy this definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ncount</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># total number of routing steps</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># current routing step</span>

    <span class="n">route_reached_destination</span><span class="p">:</span> <span class="nb">bool</span>  <span class="c1"># True everytime one route (or more) reaches the destination in a routing step</span>
    <span class="n">route_reached_waypoint</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="n">start_temp</span><span class="p">:</span> <span class="nb">tuple</span>  <span class="c1"># changes if intermediate waypoints are used</span>
    <span class="n">finish_temp</span><span class="p">:</span> <span class="nb">tuple</span>  <span class="c1"># changes if intermediate waypoints are used</span>
    <span class="n">gcr_course_temp</span><span class="p">:</span> <span class="nb">tuple</span>

    <span class="n">lats_per_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># lats: (M,N) array, N=headings+1, M=steps (M decreasing)</span>
    <span class="n">lons_per_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># longs: (M,N) array, N=headings+1, M=steps</span>
    <span class="n">course_per_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># course (0 - 360°)</span>
    <span class="n">dist_per_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># geodesic distance traveled per time stamp:</span>
    <span class="n">shipparams_per_step</span><span class="p">:</span> <span class="n">ShipParams</span>  <span class="c1"># object storing ship parameters (fuel rate, power consumption ...)</span>
    <span class="n">starttime_per_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># start time for every routing step (datetime object)</span>
    <span class="n">absolutefuel_per_step</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>   <span class="c1"># (kg)</span>

    <span class="n">current_course</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># current course (0-360°)</span>

    <span class="c1"># the lenght of the following arrays depends on the number of courses (course segments)</span>
    <span class="n">full_dist_traveled</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># full geodesic distance since start for all courses</span>
    <span class="n">full_time_traveled</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># time elapsed since start for all courses</span>
    <span class="n">time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>  <span class="c1"># current datetime for all courses</span>

    <span class="n">course_segments</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of course segments in the range of -180° to 180°</span>
    <span class="n">course_increments_deg</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># increment between different variants</span>
    <span class="n">prune_sector_deg_half</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># angular range of course that is considered for pruning (only one half, 0-180°)</span>
    <span class="n">prune_segments</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># number of course bins that are used for pruning</span>
    <span class="n">prune_symmetry_axis</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># method to define pruning symmetry axis</span>
    <span class="n">prune_groups</span><span class="p">:</span> <span class="nb">str</span>   <span class="c1"># method to define grouping of route segments before the pruning</span>
    <span class="n">minimisation_criterion</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># minimisation criterion</span>

    <span class="n">desired_number_of_routes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">current_number_of_routes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">current_step_routes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="n">next_step_routes</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="n">route_list</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">pruning_error</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ncount</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">ISOCHRONE_MAX_ROUTING_STEPS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">meter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span> <span class="o">=</span> <span class="n">ShipParams</span><span class="o">.</span><span class="n">set_default_array</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">departure_time</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">kg</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">departure_time</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_destination</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_waypoint</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pruning_error</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcr_course_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcr_course</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">desired_number_of_routes</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">ISOCHRONE_NUMBER_OF_ROUTES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">route_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minimisation_criterion</span> <span class="o">=</span> <span class="s1">&#39;squareddist_over_disttodest&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_pruning_settings</span><span class="p">(</span><span class="n">sector_deg_half</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ISOCHRONE_PRUNE_SECTOR_DEG_HALF</span><span class="p">,</span>
                                  <span class="n">seg</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ISOCHRONE_PRUNE_SEGMENTS</span><span class="p">,</span> <span class="n">prune_groups</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ISOCHRONE_PRUNE_GROUPS</span><span class="p">,</span>
                                  <span class="n">prune_symmetry_axis</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ISOCHRONE_PRUNE_SYMMETRY_AXIS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_course_segments</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">ROUTER_HDGS_SEGMENTS</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">ROUTER_HDGS_INCREMENTS_DEG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_minimisation_criterion</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">ISOCHRONE_MINIMISATION_CRITERION</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_route_folder</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">ROUTE_PATH</span>

<div class="viewcode-block" id="IsoBased.print_init">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.print_init">[docs]</a>
    <span class="k">def</span> <span class="nf">print_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">RoutingAlg</span><span class="o">.</span><span class="n">print_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;pruning settings&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;ISOCHRONE_PRUNE_SECTOR_DEG_HALF: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;ISOCHRONE_PRUNE_SEGMENTS: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;ISOCHRONE_PRUNE_SYMMETRY_AXIS: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_symmetry_axis</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;ISOCHRONE_PRUNE_GROUPS: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_groups</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;ISOCHRONE_MINIMISATION_CRITERION: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimisation_criterion</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;ROUTER_HDGS_SEGMENTS: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;ROUTER_HDGS_INCREMENTS_DEG: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_increments_deg</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span></div>


<div class="viewcode-block" id="IsoBased.print_current_status">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.print_current_status">[docs]</a>
    <span class="k">def</span> <span class="nf">print_current_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PRINTING ALG SETTINGS&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;step = &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;per-step variables:&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;lats_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;lons_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;courses = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;dist_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;starttime_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;absolut_fuel_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;per-course variables&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;time =&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;full_dist_traveled=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;full_time_traveled = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span><span class="p">)))</span></div>


<div class="viewcode-block" id="IsoBased.print_shape">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.print_shape">[docs]</a>
    <span class="k">def</span> <span class="nf">print_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PRINTING SHAPE&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;per-step variables:&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;lats_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;lons_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;courses = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;dist_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;absolute_fuel_per_step = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">print_shape</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;per-course variables:&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;time =&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;full_dist_traveled = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_log_step</span><span class="p">(</span><span class="s1">&#39;full_time_traveled = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span></div>


<div class="viewcode-block" id="IsoBased.current_position">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.current_position">[docs]</a>
    <span class="k">def</span> <span class="nf">current_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CURRENT POSITION&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;lats = &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lats</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;lons = &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_lons</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;course = &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;full_time_traveled = &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.define_courses">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.define_courses">[docs]</a>
    <span class="k">def</span> <span class="nf">define_courses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># branch out for multiple headings</span>
        <span class="n">nof_input_routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">new_finish_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nof_input_routes</span><span class="p">)</span>
        <span class="n">new_finish_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nof_input_routes</span><span class="p">)</span>

        <span class="n">new_course</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_finish_one</span><span class="p">,</span> <span class="n">new_finish_two</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">define_courses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_course_def</span><span class="p">()</span>

        <span class="c1"># determine new headings - centered around gcrs X0 -&gt; X_prev_step</span>
        <span class="n">delta_hdgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_increments_deg</span><span class="p">,</span>
                                 <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_increments_deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">delta_hdgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">delta_hdgs</span><span class="p">,</span> <span class="n">nof_input_routes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">=</span> <span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>  <span class="c1"># center courses around gcr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">-</span> <span class="n">delta_hdgs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">cut_angles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.define_initial_variants">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.define_initial_variants">[docs]</a>
    <span class="k">def</span> <span class="nf">define_initial_variants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="IsoBased.execute_routing">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.execute_routing">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boat</span><span class="p">:</span> <span class="n">Boat</span><span class="p">,</span> <span class="n">wt</span><span class="p">:</span> <span class="n">WeatherCond</span><span class="p">,</span> <span class="n">constraints_list</span><span class="p">:</span> <span class="n">ConstraintsList</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Progress one isochrone with pruning/optimising route for specific time segment</span>

<span class="sd">            Parameters:</span>
<span class="sd">                iso1 (Isochrone) - starting isochrone</span>
<span class="sd">                start_point (tuple) - starting point of the route</span>
<span class="sd">                end_point (tuple) - end point of the route</span>
<span class="sd">                x1_coords (tuple) - tuple of arrays (lats, lons)</span>
<span class="sd">                x2_coords (tuple) - tuple of arrays (lats, lons)</span>
<span class="sd">                boat (dict) - boat profile</span>
<span class="sd">                winds (dict) - wind functions</span>
<span class="sd">                start_time (datetime) - start time</span>
<span class="sd">                delta_time (float) - time to move in seconds</span>
<span class="sd">                params (dict) - isochrone calculation parameters</span>

<span class="sd">            Returns:</span>
<span class="sd">                iso (Isochrone) - next isochrone</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_for_positive_constraints</span><span class="p">(</span><span class="n">constraints_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_initial_variants</span><span class="p">()</span>
        <span class="c1"># start_time=time.time()</span>
        <span class="c1"># self.print_shape()</span>

        <span class="c1"># Note: self.count starts at 0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncount</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">get_line_string</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Step &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">define_courses_per_step</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_boat_direct</span><span class="p">(</span><span class="n">wt</span><span class="p">,</span> <span class="n">boat</span><span class="p">,</span> <span class="n">constraints_list</span><span class="p">)</span>

            <span class="c1"># Distinguish situations where the ship reached the final destination and where it reached a waypoint</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_destination</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initiating last step at routing step &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_number_of_routes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_number_of_routes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">find_every_route_reaching_destination</span><span class="p">()</span>
                    <span class="n">number_of_possible_routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_step_routes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_number_of_routes</span> <span class="o">&lt;=</span> <span class="n">number_of_possible_routes</span><span class="p">:</span>
                        <span class="n">remaining_routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_number_of_routes</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_routes_reaching_destination_in_current_step</span><span class="p">(</span><span class="n">remaining_routes</span><span class="p">)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_routes_reaching_destination_in_current_step</span><span class="p">(</span><span class="n">number_of_possible_routes</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_step_routes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No routes left for execution, terminating!&#39;</span><span class="p">)</span>
                            <span class="k">break</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">set_next_step_routes</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pruning_per_step</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruning_error</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_destination</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">update_fig</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_waypoint</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initiating pruning for intermediate waypoint at routing step&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_pruning</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_axis_for_intermediate</span><span class="p">()</span>
                <span class="n">constraints_list</span><span class="o">.</span><span class="n">reached_positive</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span> <span class="o">=</span> <span class="n">constraints_list</span><span class="o">.</span><span class="n">get_current_destination</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span> <span class="o">=</span> <span class="n">constraints_list</span><span class="o">.</span><span class="n">get_current_start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gcr_course_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_gcr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_waypoint</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initiating routing for next segment going from &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_fig</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pruning_per_step</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruning_error</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_fig</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruning_error</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revert_to_previous_step</span><span class="p">()</span>

        <span class="c1"># ToDo: harmonize with above/merge with loop over routing steps</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_number_of_routes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_pruning</span><span class="p">()</span>
            <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">route</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruning_error</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">routes_from_previous_step</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_pruning</span><span class="p">()</span>
                <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">route</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">route_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_full_fuel</span><span class="p">())</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="IsoBased.move_boat_direct">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.move_boat_direct">[docs]</a>
    <span class="k">def</span> <span class="nf">move_boat_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wt</span><span class="p">:</span> <span class="n">WeatherCond</span><span class="p">,</span> <span class="n">boat</span><span class="p">:</span> <span class="n">Boat</span><span class="p">,</span> <span class="n">constraint_list</span><span class="p">:</span> <span class="n">ConstraintsList</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculate new boat position for current time step based on wind and boat function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get wind speed (tws) and angle (twa)</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># get boat speed</span>
        <span class="n">bs</span> <span class="o">=</span> <span class="n">boat</span><span class="o">.</span><span class="n">get_boat_speed</span><span class="p">()</span>
        <span class="n">bs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_course</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># TODO: check whether changes on IntegrateGeneticAlgorithm should be applied here</span>
        <span class="n">ship_params</span> <span class="o">=</span> <span class="n">boat</span><span class="o">.</span><span class="n">get_ship_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_course</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lats</span><span class="p">(),</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lons</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">units</span><span class="o">.</span><span class="n">cut_angles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">)</span>

        <span class="c1"># ship_params.print()</span>

        <span class="n">delta_time</span><span class="p">,</span> <span class="n">delta_fuel</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_variables_netCDF</span><span class="p">(</span><span class="n">ship_params</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span>
        <span class="c1"># ToDo: remove debug variable and use logger settings instead</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;delta_time: &#39;</span><span class="p">,</span> <span class="n">delta_time</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;delta_fuel: &#39;</span><span class="p">,</span> <span class="n">delta_fuel</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;dist: &#39;</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;route_reached_destination:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_destination</span><span class="p">)</span>

        <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_bearing</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;move:&#39;</span><span class="p">,</span> <span class="n">move</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_destination</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_waypoint</span><span class="p">:</span>
            <span class="n">delta_time_last_step</span><span class="p">,</span> <span class="n">delta_fuel_last_step</span><span class="p">,</span> <span class="n">dist_last_step</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">get_delta_variables_netCDF_last_step</span><span class="p">(</span><span class="n">ship_params</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_destination</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bool_arr_reached_final</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_arr_reached_final</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">delta_time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_time_last_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">delta_fuel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_fuel_last_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_last_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta_time</span> <span class="o">=</span> <span class="n">delta_time_last_step</span>
                <span class="n">delta_fuel</span> <span class="o">=</span> <span class="n">delta_fuel_last_step</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">dist_last_step</span>

        <span class="n">is_constrained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_constraints</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="n">constraint_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_position</span><span class="p">(</span><span class="n">move</span><span class="p">,</span> <span class="n">is_constrained</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_time</span><span class="p">(</span><span class="n">delta_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fuel</span><span class="p">(</span><span class="n">delta_fuel</span><span class="p">,</span> <span class="n">ship_params</span><span class="o">.</span><span class="n">get_fuel_rate</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shipparams</span><span class="p">(</span><span class="n">ship_params</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.find_every_route_reaching_destination">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.find_every_route_reaching_destination">[docs]</a>
    <span class="k">def</span> <span class="nf">find_every_route_reaching_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function finds routes reaching the destination in the current last step of routing.</span>
<span class="sd">        First, it creates a dataframe with origin point of the current route segments.</span>
<span class="sd">        The route segments are grouped according to the origin point.</span>
<span class="sd">        &#39;dist&#39; is the distance that could be travelled with available amount of fuel.</span>
<span class="sd">        &#39;dist_dest&#39; is the distance from origin point to the destination.</span>
<span class="sd">        &#39;st_index&#39; is storing the same index order of other nd arrays such as self.lats_per_step</span>
<span class="sd">        before grouping. So that, later it is referred in find_routes_reaching_destination_in_current_step function.</span>
<span class="sd">        (acts as a key from the dataframe to other arrays such as self.lats_per_step )</span>

<span class="sd">        Routes from the current step reaching the destination are stored in &#39;current_step_routes&#39; dataframe.</span>
<span class="sd">        Only the one route segment per branch originating from the same origin point that minimize the fuel is stored</span>
<span class="sd">        in current_step_routes. Routes which are not reaching the destination in the current step are stored in</span>
<span class="sd">        &#39;next_step_routes&#39; dataframe. In this case, all routes originating from the same origin point are stored in</span>
<span class="sd">        the dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_current_last_step</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;st_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;st_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_last_step_dist</span><span class="o">.</span><span class="n">value</span>    <span class="c1"># pandas struggles with units</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;dist_dest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_last_step_dist_to_dest</span><span class="o">.</span><span class="n">value</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">value</span>

        <span class="n">len_df</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">len_df</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;st_index&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_current_last_step</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;st_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lon&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df_grouped_by_routes_has_same_origin</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;st_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lon&#39;</span><span class="p">])</span>

        <span class="n">unique_origins</span> <span class="o">=</span> <span class="n">df_grouped_by_routes_has_same_origin</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">unique_key</span> <span class="ow">in</span> <span class="n">unique_origins</span><span class="p">:</span>
            <span class="n">specific_route_group</span> <span class="o">=</span> <span class="n">df_grouped_by_routes_has_same_origin</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">unique_key</span><span class="p">)</span>

            <span class="n">df_reaching_destination</span> <span class="o">=</span> <span class="n">specific_route_group</span><span class="p">[</span>
                <span class="n">specific_route_group</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">specific_route_group</span><span class="p">[</span><span class="s1">&#39;dist_dest&#39;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="n">num_rows</span> <span class="o">=</span> <span class="n">df_reaching_destination</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">min_fuel</span> <span class="o">=</span> <span class="n">df_reaching_destination</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">rows_min_fuel</span> <span class="o">=</span> <span class="n">df_reaching_destination</span><span class="p">[</span><span class="n">df_reaching_destination</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_fuel</span><span class="p">]</span>
                <span class="c1"># Make sure we keep only one route (ToDo: which one do we want to keep?)</span>
                <span class="n">row_min_fuel</span> <span class="o">=</span> <span class="n">rows_min_fuel</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s1">&#39;fuel&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">current_step_routes</span><span class="p">,</span> <span class="n">row_min_fuel</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">next_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">next_step_routes</span><span class="p">,</span> <span class="n">specific_route_group</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.find_routes_reaching_destination_in_current_step">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.find_routes_reaching_destination_in_current_step">[docs]</a>
    <span class="k">def</span> <span class="nf">find_routes_reaching_destination_in_current_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remaining_routes</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In this function, different routes obtained from &#39;find_every_route_reaching_destination&#39;</span>
<span class="sd">        and stored in current_step_routes dataframe are sorted by minimum fuel.</span>
<span class="sd">        The number of routes that are selected is specified by the variable remaining_routes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_step_routes_sort_by_fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_step_routes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">])</span>
        <span class="n">route_df</span> <span class="o">=</span> <span class="n">current_step_routes_sort_by_fuel</span><span class="p">[</span><span class="s1">&#39;st_index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">remaining_routes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idxs</span> <span class="ow">in</span> <span class="n">route_df</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">route_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_route_object</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_status</span><span class="p">(</span><span class="n">route_object</span><span class="o">.</span><span class="n">ship_params_per_step</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">route_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route_object</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_route_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">route_object</span><span class="o">.</span><span class="n">return_route_to_API</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_route_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>
                                                 <span class="s1">&#39;route_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_number_of_routes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_routes</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.make_route_object">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.make_route_object">[docs]</a>
    <span class="k">def</span> <span class="nf">make_route_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxs</span><span class="p">):</span>

        <span class="c1"># ToDo: very similar to IsoFuel.final_pruning -&gt; harmonize</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">lats_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="n">lons_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="n">course_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="n">dist_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="n">shipparams_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_reduced_2D_object</span><span class="p">(</span><span class="n">idxs</span><span class="o">=</span><span class="n">idxs</span><span class="p">)</span>

            <span class="n">starttime_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>

            <span class="n">lats_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lats_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">lons_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lons_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">course_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">course_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">dist_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">dist_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">starttime_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">starttime_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Pruned indices running out of bounds.&#39;</span><span class="p">)</span>

        <span class="n">route</span> <span class="o">=</span> <span class="n">RouteParams</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                            <span class="n">finish</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">,</span> <span class="n">gcr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">,</span>
                            <span class="n">route_type</span><span class="o">=</span><span class="s1">&#39;min_time_route&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                            <span class="n">lats_per_step</span><span class="o">=</span><span class="n">lats_per_step</span><span class="p">,</span>
                            <span class="n">lons_per_step</span><span class="o">=</span><span class="n">lons_per_step</span><span class="p">,</span>
                            <span class="n">course_per_step</span><span class="o">=</span><span class="n">course_per_step</span><span class="p">,</span>
                            <span class="n">dists_per_step</span><span class="o">=</span><span class="n">dist_per_step</span><span class="p">,</span>
                            <span class="n">starttime_per_step</span><span class="o">=</span><span class="n">starttime_per_step</span><span class="p">,</span>
                            <span class="n">ship_params_per_step</span><span class="o">=</span><span class="n">shipparams_per_step</span>
                            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_groups</span> <span class="o">=</span> <span class="s1">&#39;branch&#39;</span>
        <span class="k">return</span> <span class="n">route</span></div>


<div class="viewcode-block" id="IsoBased.plot_routes">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.plot_routes">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot every complete individual route that is reaching the destination</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">generate_basemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">)</span>

        <span class="n">lats_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
        <span class="n">lons_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>

        <span class="n">route</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lons_per_step</span><span class="p">,</span>
                         <span class="n">lats_per_step</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">)</span>

        <span class="n">route_ensemble</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">route_ensemble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>

        <span class="n">route</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">lons_per_step</span><span class="p">)</span>
        <span class="n">route</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">lats_per_step</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span>

        <span class="n">final_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="o">+</span> <span class="s1">&#39;/fig&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_route_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save updated figure to &#39;</span> <span class="o">+</span> <span class="n">final_path</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.set_next_step_routes">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.set_next_step_routes">[docs]</a>
    <span class="k">def</span> <span class="nf">set_next_step_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updating all arrays according to the indices of the routes that need to be further</span>
<span class="sd">        processed in the next routing step</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sorting order matters here????</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_step_routes</span><span class="p">[</span><span class="s1">&#39;st_index&#39;</span><span class="p">]</span>
        <span class="c1"># Return a trimmed isochrone</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Pruned indices running out of bounds.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.revert_to_previous_step">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.revert_to_previous_step">[docs]</a>
    <span class="k">def</span> <span class="nf">revert_to_previous_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In this function, when all routes are constrained, the arrays are set</span>
<span class="sd">        back to previous step to provide meaningful error message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fig</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">last_idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">last_idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">last_idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">last_idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">last_idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">last_idx</span><span class="p">,</span> <span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_reduced_2D_object</span><span class="p">(</span><span class="n">row_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                           <span class="n">row_end</span><span class="o">=</span><span class="n">last_idx</span><span class="p">,</span>
                                                           <span class="n">col_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">col_end</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                                                           <span class="n">idxs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">col_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">col_len</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">col_len</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">col_len</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">col_len</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Pruned indices running out of bounds.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.routes_from_previous_step">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.routes_from_previous_step">[docs]</a>
    <span class="k">def</span> <span class="nf">routes_from_previous_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        When all routes are constrained, unique routes until the current constrained</span>
<span class="sd">        routing step are found here. Then, the unique routes are written into json files</span>
<span class="sd">        and plotted.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">df_current_last_step</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;st_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;st_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_fuel</span><span class="p">()[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">len_df</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">len_df</span><span class="p">),</span>
                                       <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;st_index&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_current_last_step</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;st_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lon&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df_grouped_by_routes_has_same_origin</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;st_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lon&#39;</span><span class="p">])</span>

        <span class="n">unique_origins</span> <span class="o">=</span> <span class="n">df_grouped_by_routes_has_same_origin</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="n">current_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">unique_key</span> <span class="ow">in</span> <span class="n">unique_origins</span><span class="p">:</span>
            <span class="n">specific_route_group</span> <span class="o">=</span> <span class="n">df_grouped_by_routes_has_same_origin</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span>
                <span class="n">unique_key</span><span class="p">)</span>
            <span class="n">row_min_fuel</span> <span class="o">=</span> <span class="n">specific_route_group</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">])</span>
            <span class="n">current_step_routes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">current_step_routes</span><span class="p">,</span> <span class="n">row_min_fuel</span><span class="p">],</span>
                    <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">current_step_routes_sort_by_fuel</span> <span class="o">=</span> <span class="n">current_step_routes</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fuel&#39;</span><span class="p">])</span>
        <span class="n">route_df</span> <span class="o">=</span> <span class="n">current_step_routes_sort_by_fuel</span><span class="p">[</span><span class="s1">&#39;st_index&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">route_df</span><span class="p">:</span>
            <span class="n">route_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_route_object</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">route_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">route_object</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_route_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">route_object</span><span class="o">.</span><span class="n">return_route_to_API</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_route_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;route_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_routes</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.update_shipparams">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.update_shipparams">[docs]</a>
    <span class="k">def</span> <span class="nf">update_shipparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ship_params_single_step</span><span class="p">):</span>
        <span class="n">new_rpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_rpm</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_rpm</span><span class="p">()))</span>
        <span class="n">new_power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_power</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_power</span><span class="p">()))</span>
        <span class="n">new_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_speed</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_speed</span><span class="p">()))</span>
        <span class="n">new_rwind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_rwind</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_rwind</span><span class="p">()))</span>
        <span class="n">new_rcalm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_rcalm</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_rcalm</span><span class="p">()))</span>
        <span class="n">new_rwaves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_rwaves</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_rwaves</span><span class="p">()))</span>
        <span class="n">new_rshallow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_rshallow</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_rshallow</span><span class="p">()))</span>
        <span class="n">new_rroughness</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_rroughness</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_rroughness</span><span class="p">()))</span>
        <span class="n">new_wave_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_wave_height</span><span class="p">(),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_wave_height</span><span class="p">()))</span>
        <span class="n">new_wave_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_wave_direction</span><span class="p">(),</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_wave_direction</span><span class="p">()))</span>
        <span class="n">new_wave_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_wave_period</span><span class="p">(),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_wave_period</span><span class="p">()))</span>
        <span class="n">new_u_currents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_u_currents</span><span class="p">(),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_u_currents</span><span class="p">()))</span>
        <span class="n">new_v_currents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_v_currents</span><span class="p">(),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_v_currents</span><span class="p">()))</span>
        <span class="n">new_u_wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_u_wind_speed</span><span class="p">(),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_u_wind_speed</span><span class="p">()))</span>
        <span class="n">new_v_wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_v_wind_speed</span><span class="p">(),</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_v_wind_speed</span><span class="p">()))</span>
        <span class="n">new_pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_pressure</span><span class="p">()))</span>
        <span class="n">new_air_temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_air_temperature</span><span class="p">(),</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_air_temperature</span><span class="p">()))</span>
        <span class="n">new_salinity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_salinity</span><span class="p">(),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_salinity</span><span class="p">()))</span>
        <span class="n">new_water_temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_water_temperature</span><span class="p">(),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_water_temperature</span><span class="p">()))</span>
        <span class="n">new_status</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_status</span><span class="p">()))</span>
        <span class="n">new_message</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ship_params_single_step</span><span class="o">.</span><span class="n">get_message</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_message</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_rpm</span><span class="p">(</span><span class="n">new_rpm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">new_power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_speed</span><span class="p">(</span><span class="n">new_speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_rwind</span><span class="p">(</span><span class="n">new_rwind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_rcalm</span><span class="p">(</span><span class="n">new_rcalm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_rwaves</span><span class="p">(</span><span class="n">new_rwaves</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_rshallow</span><span class="p">(</span><span class="n">new_rshallow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_rroughness</span><span class="p">(</span><span class="n">new_rroughness</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_wave_height</span><span class="p">(</span><span class="n">new_wave_height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_wave_direction</span><span class="p">(</span><span class="n">new_wave_direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_wave_period</span><span class="p">(</span><span class="n">new_wave_period</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_u_currents</span><span class="p">(</span><span class="n">new_u_currents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_v_currents</span><span class="p">(</span><span class="n">new_v_currents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_u_wind_speed</span><span class="p">(</span><span class="n">new_u_wind_speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_v_wind_speed</span><span class="p">(</span><span class="n">new_v_wind_speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">new_pressure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_air_temperature</span><span class="p">(</span><span class="n">new_air_temperature</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_salinity</span><span class="p">(</span><span class="n">new_salinity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_water_temperature</span><span class="p">(</span><span class="n">new_water_temperature</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_status</span><span class="p">(</span><span class="n">new_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">new_message</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.check_course_def">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_course_def">[docs]</a>
    <span class="k">def</span> <span class="nf">check_course_def</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))):</span>
            <span class="k">raise</span> <span class="s1">&#39;define_courses: number of columns not matching!&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;define_courses: number of rows not matching! count = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; lats per step &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>


<div class="viewcode-block" id="IsoBased.get_pruned_indices_statistics">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_pruned_indices_statistics">[docs]</a>
    <span class="k">def</span> <span class="nf">get_pruned_indices_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span><span class="p">,</span> <span class="n">trim</span><span class="p">):</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">trim</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">bin_stat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">==</span> <span class="n">bin_stat</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idxs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">==</span> <span class="n">bin_stat</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">subl</span> <span class="ow">in</span> <span class="n">idxs</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">subl</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">idxs</span></div>


<div class="viewcode-block" id="IsoBased.pruning">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.pruning">[docs]</a>
    <span class="k">def</span> <span class="nf">pruning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trim</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">valid_pruning_segments</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>

        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;binning for pruning&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current courses&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full_dist_traveled&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">)</span>

        <span class="n">is_pruned</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_groups</span> <span class="o">==</span> <span class="s1">&#39;larger_direction&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Executing larger-direction-based pruning.&#39;</span><span class="p">)</span>
            <span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">larger_direction_based_pruning</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pruned_indices_statistics</span><span class="p">(</span><span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span><span class="p">,</span> <span class="n">trim</span><span class="p">)</span>
            <span class="n">is_pruned</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_groups</span> <span class="o">==</span> <span class="s1">&#39;courses&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Executing courses-based pruning.&#39;</span><span class="p">)</span>
            <span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">courses_based_pruning</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pruned_indices_statistics</span><span class="p">(</span><span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span><span class="p">,</span> <span class="n">trim</span><span class="p">)</span>
            <span class="n">is_pruned</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_groups</span> <span class="o">==</span> <span class="s1">&#39;branch&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Executing branch-based pruning.&#39;</span><span class="p">)</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_based_pruning</span><span class="p">()</span>
            <span class="n">is_pruned</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_pruned</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The selected pruning option is not available!&#39;</span><span class="p">)</span>

        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full_dist_traveled&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Indexes that passed&#39;</span><span class="p">,</span> <span class="n">idxs</span><span class="p">)</span>

        <span class="n">valid_pruning_segments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">valid_pruning_segments</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39; All pruning segments fully constrained for step &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pruning_error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">valid_pruning_segments</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39; More than 90</span><span class="si">% o</span><span class="s1">f pruning segments constrained for step &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">valid_pruning_segments</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39; More than 50</span><span class="si">% o</span><span class="s1">f pruning segments constrained for step &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">)</span>

        <span class="c1"># Return a trimmed isochrone</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">[:,</span> <span class="n">idxs</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Pruned indices running out of bounds.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.courses_based_pruning">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.courses_based_pruning">[docs]</a>
    <span class="k">def</span> <span class="nf">courses_based_pruning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
        <span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">,</span>
                                                           <span class="n">statistic</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span></div>


<div class="viewcode-block" id="IsoBased.larger_direction_based_pruning">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.larger_direction_based_pruning">[docs]</a>
    <span class="k">def</span> <span class="nf">larger_direction_based_pruning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
        <span class="n">start_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">start_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">larger_direction</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">start_lats</span><span class="p">,</span> <span class="n">start_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">larger_direction</span> <span class="o">=</span> <span class="n">larger_direction</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span>
        <span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">larger_direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">,</span>
                                                           <span class="n">statistic</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bin_stat</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">bin_number</span></div>


<div class="viewcode-block" id="IsoBased.branch_based_pruning">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.branch_based_pruning">[docs]</a>
    <span class="k">def</span> <span class="nf">branch_based_pruning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">df_current_last_step</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;st_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;st_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">df_current_last_step</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span>

        <span class="n">len_df</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">len_df</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;st_index&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_current_last_step</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;st_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lon&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df_grouped_by_routes_has_same_origin</span> <span class="o">=</span> <span class="n">df_current_last_step</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;st_lat&#39;</span><span class="p">,</span> <span class="s1">&#39;st_lon&#39;</span><span class="p">])</span>

        <span class="n">unique_origins</span> <span class="o">=</span> <span class="n">df_grouped_by_routes_has_same_origin</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">unique_key</span> <span class="ow">in</span> <span class="n">unique_origins</span><span class="p">:</span>
            <span class="n">specific_route_group</span> <span class="o">=</span> <span class="n">df_grouped_by_routes_has_same_origin</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">unique_key</span><span class="p">)</span>

            <span class="n">max_dist</span> <span class="o">=</span> <span class="n">specific_route_group</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">max_dist</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">max_dist_indxs</span> <span class="o">=</span> <span class="n">specific_route_group</span><span class="p">[</span><span class="n">specific_route_group</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_dist</span><span class="p">][</span><span class="s1">&#39;st_index&#39;</span><span class="p">]</span>
            <span class="n">max_dist_indxs</span> <span class="o">=</span> <span class="n">max_dist_indxs</span><span class="o">.</span><span class="n">values</span>
            <span class="n">max_dist_indxs</span> <span class="o">=</span> <span class="n">max_dist_indxs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>

            <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_dist_indxs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">idxs</span></div>


<div class="viewcode-block" id="IsoBased.pruning_per_step">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.pruning_per_step">[docs]</a>
    <span class="k">def</span> <span class="nf">pruning_per_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_symmetry_axis</span> <span class="o">==</span> <span class="s1">&#39;gcr&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pruning_gcr_centered</span><span class="p">(</span><span class="n">trim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pruning_headings_centered</span><span class="p">(</span><span class="n">trim</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.pruning_gcr_centered">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.pruning_gcr_centered">[docs]</a>
    <span class="k">def</span> <span class="nf">pruning_gcr_centered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For every pruning segment, select the route that maximises the distance towards the starting point (or last</span>
<span class="sd">        intermediate waypoint). All other routes are discarded. The symmetry axis of the pruning segments is defined</span>
<span class="sd">        based on the gcr</span>
<span class="sd">        of the current &#39;mean&#39; position towards the (temporary) destination.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pruning... Pruning symmetry axis defined by gcr&#39;</span><span class="p">)</span>

        <span class="c1"># Calculate the auxiliary coordinate for the definition of pruning symmetry axis. The route is propagated</span>
        <span class="c1"># towards the coordinate</span>
        <span class="c1"># which is reached if one travels from the starting point (or last intermediate waypoint) in the direction</span>
        <span class="c1"># of the course defined by the distance between the start point and the destination for the mean distance</span>
        <span class="c1"># travelled</span>
        <span class="c1"># during the current routing step.</span>
        <span class="n">start_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">start_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">full_travel_dist</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">start_lats</span><span class="p">,</span> <span class="n">start_lons</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mean_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">full_travel_dist</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">])</span>
        <span class="n">gcr_point</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcr_course_temp</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">mean_dist</span><span class="p">)</span>

        <span class="n">new_course</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">gcr_point</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">],</span> <span class="n">gcr_point</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>

        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current mean end point: (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gcr_point</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gcr_point</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current temporary start: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current temporary destination: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean course&#39;</span><span class="p">,</span> <span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">])</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">generate_basemap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">)</span>

            <span class="c1"># plot symmetry axis and boundaries of pruning area</span>
            <span class="n">symmetry_axis</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">],</span> <span class="mi">1000000</span><span class="p">)</span>
            <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                      <span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
            <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                      <span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">symmetry_axis</span><span class="p">[</span><span class="s2">&quot;lon2&quot;</span><span class="p">]],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symmetry_axis</span><span class="p">[</span><span class="s2">&quot;lat2&quot;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lower_bound</span><span class="p">[</span><span class="s2">&quot;lon2&quot;</span><span class="p">]],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lower_bound</span><span class="p">[</span><span class="s2">&quot;lat2&quot;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">upper_bound</span><span class="p">[</span><span class="s2">&quot;lon2&quot;</span><span class="p">]],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">upper_bound</span><span class="p">[</span><span class="s2">&quot;lat2&quot;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">final_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="o">+</span> <span class="s1">&#39;/fig&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_gcr_symmetry_axis.png&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving updated figure to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">final_path</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span>

        <span class="c1"># define pruning area</span>
        <span class="n">azi0s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">delta_hdgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">bins</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">cut_angles</span><span class="p">(</span><span class="n">azi0s</span> <span class="o">-</span> <span class="n">delta_hdgs</span><span class="p">)</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pruning</span><span class="p">(</span><span class="n">trim</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.pruning_headings_centered">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.pruning_headings_centered">[docs]</a>
    <span class="k">def</span> <span class="nf">pruning_headings_centered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For every pruning segment, select the route that maximises the distance towards the starting point (or last</span>
<span class="sd">        intermediate waypoint). All other routes are discarded. The symmetry axis of the pruning segments is given by</span>
<span class="sd">        the median of all considered courses.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pruning... Pruning symmetry axis defined by median of considered headings.&#39;</span><span class="p">)</span>

        <span class="c1"># propagate current end points towards temporary destination</span>
        <span class="n">non_zero_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cat_lats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">non_zero_idxs</span><span class="p">]</span>
        <span class="n">cat_lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">non_zero_idxs</span><span class="p">]</span>
        <span class="n">new_finish_one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cat_lats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">new_finish_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cat_lats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">new_course</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">cat_lats</span><span class="p">,</span> <span class="n">cat_lons</span><span class="p">,</span> <span class="n">new_finish_one</span><span class="p">,</span> <span class="n">new_finish_two</span><span class="p">)</span>
        <span class="n">mean_course</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">new_course</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean course: &#39;</span><span class="p">,</span> <span class="n">mean_course</span><span class="p">)</span>
            <span class="c1"># plot symmetry axis and boundaries of pruning area</span>
            <span class="n">symmetry_axis</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                        <span class="n">mean_course</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
            <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                      <span class="n">mean_course</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
            <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                      <span class="n">mean_course</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">symmetry_axis</span><span class="p">[</span><span class="s2">&quot;lon2&quot;</span><span class="p">]],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">symmetry_axis</span><span class="p">[</span><span class="s2">&quot;lat2&quot;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lower_bound</span><span class="p">[</span><span class="s2">&quot;lon2&quot;</span><span class="p">]],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lower_bound</span><span class="p">[</span><span class="s2">&quot;lat2&quot;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">upper_bound</span><span class="p">[</span><span class="s2">&quot;lon2&quot;</span><span class="p">]],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">upper_bound</span><span class="p">[</span><span class="s2">&quot;lat2&quot;</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">final_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="o">+</span> <span class="s1">&#39;/fig&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_median.png&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Saving updated figure to &#39;</span> <span class="o">+</span> <span class="n">final_path</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span>

        <span class="c1"># define pruning area</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">get_angle_bins</span><span class="p">(</span><span class="n">mean_course</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span>
                                    <span class="n">mean_course</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>

        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bins: &#39;</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pruning</span><span class="p">(</span><span class="n">trim</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.define_courses_per_step">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.define_courses_per_step">[docs]</a>
    <span class="k">def</span> <span class="nf">define_courses_per_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_courses</span><span class="p">()</span></div>


<div class="viewcode-block" id="IsoBased.set_pruning_settings">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.set_pruning_settings">[docs]</a>
    <span class="k">def</span> <span class="nf">set_pruning_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sector_deg_half</span><span class="p">,</span> <span class="n">seg</span><span class="p">,</span> <span class="n">prune_groups</span><span class="p">,</span> <span class="n">prune_symmetry_axis</span><span class="o">=</span><span class="s1">&#39;gcr&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span> <span class="o">=</span> <span class="n">sector_deg_half</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span> <span class="o">=</span> <span class="n">seg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_groups</span> <span class="o">=</span> <span class="n">prune_groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_symmetry_axis</span> <span class="o">=</span> <span class="n">prune_symmetry_axis</span></div>


<div class="viewcode-block" id="IsoBased.set_minimisation_criterion">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.set_minimisation_criterion">[docs]</a>
    <span class="k">def</span> <span class="nf">set_minimisation_criterion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimisation_criterion</span> <span class="o">=</span> <span class="n">min_str</span></div>


<div class="viewcode-block" id="IsoBased.set_course_segments">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.set_course_segments">[docs]</a>
    <span class="k">def</span> <span class="nf">set_course_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">,</span> <span class="n">inc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">=</span> <span class="n">seg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">course_increments_deg</span> <span class="o">=</span> <span class="n">inc</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span></div>


<div class="viewcode-block" id="IsoBased.get_current_course">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_current_course">[docs]</a>
    <span class="k">def</span> <span class="nf">get_current_course</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span></div>


<div class="viewcode-block" id="IsoBased.get_current_lats">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_current_lats">[docs]</a>
    <span class="k">def</span> <span class="nf">get_current_lats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span></div>


<div class="viewcode-block" id="IsoBased.get_current_lons">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_current_lons">[docs]</a>
    <span class="k">def</span> <span class="nf">get_current_lons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span></div>


<div class="viewcode-block" id="IsoBased.get_current_speed">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_current_speed">[docs]</a>
    <span class="k">def</span> <span class="nf">get_current_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="IsoBased.get_wind_functions">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_wind_functions">[docs]</a>
    <span class="k">def</span> <span class="nf">get_wind_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wt</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">winds</span> <span class="o">=</span> <span class="n">wt</span><span class="o">.</span><span class="n">get_wind_function</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_lats</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lons</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;obtaining wind function for position: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lats</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lons</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;winds&#39;</span><span class="p">,</span> <span class="n">winds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">winds</span></div>


<div class="viewcode-block" id="IsoBased.check_settings">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_settings">[docs]</a>
    <span class="k">def</span> <span class="nf">check_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_increments_deg</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Prune sector does not contain all courses. Please adjust settings. (course_segments=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, course_increments_deg=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">course_increments_deg</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, prune_sector_deg_half=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_sector_deg_half</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Please provide an even number of course segments, you chose: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_segments</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please provide an even number of prune segments, you chose: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_segments</span><span class="p">))</span></div>


<div class="viewcode-block" id="IsoBased.get_final_index">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_final_index">[docs]</a>
    <span class="k">def</span> <span class="nf">get_final_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx</span></div>


<div class="viewcode-block" id="IsoBased.terminate">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.terminate">[docs]</a>
    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_status</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_status</span><span class="p">(),</span> <span class="s1">&#39;minimum&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="n">route</span> <span class="o">=</span> <span class="n">RouteParams</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">,</span> <span class="n">gcr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">,</span>
                            <span class="n">route_type</span><span class="o">=</span><span class="s1">&#39;min_time_route&#39;</span><span class="p">,</span>
                            <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span><span class="p">,</span>
                            <span class="n">lats_per_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[:],</span>
                            <span class="n">lons_per_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[:],</span>
                            <span class="n">course_per_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">[:],</span>
                            <span class="n">dists_per_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">[:],</span>
                            <span class="n">starttime_per_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">[:],</span>
                            <span class="n">ship_params_per_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span>
                            <span class="p">)</span>

        <span class="k">return</span> <span class="n">route</span></div>


<div class="viewcode-block" id="IsoBased.check_status">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_status">[docs]</a>
    <span class="k">def</span> <span class="nf">check_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shipparams_per_step_status</span><span class="p">,</span> <span class="n">route_name</span><span class="p">):</span>
        <span class="n">success_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">success_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">shipparams_per_step_status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Status 1=OK</span>
        <span class="k">if</span> <span class="n">success_array</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;0</span><span class="si">% o</span><span class="s1">f status values of the route segments are successful for Route &#39;</span><span class="o">+</span><span class="n">route_name</span><span class="o">+</span><span class="s1">&#39;!&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">success_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">success_array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shipparams_per_step_status</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">success_percentage</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f status values &#39;</span>
                                                          <span class="s1">&#39;of the route segments are successful for Route &#39;</span>
                                                          <span class="o">+</span> <span class="n">route_name</span><span class="o">+</span><span class="s1">&#39;!&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.update_time">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.update_time">[docs]</a>
    <span class="k">def</span> <span class="nf">update_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_time_traveled</span> <span class="o">+=</span> <span class="n">delta_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">delta_time</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.check_bearing">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_bearing">[docs]</a>
    <span class="k">def</span> <span class="nf">check_bearing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ToDo: add description</span>
<span class="sd">        :param dist:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">ncourses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lons</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dist_to_dest</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_lats</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lons</span><span class="p">(),</span>
                                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ncourses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ncourses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">dist_to_dest</span><span class="p">[</span><span class="s2">&quot;s12&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s2">&quot;s12&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">meter</span>
        <span class="n">dist_to_dest</span><span class="p">[</span><span class="s2">&quot;azi1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s2">&quot;azi1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>
    <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dist_to_dest:&#39;</span><span class="p">,</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">])</span>
            <span class="c1"># print(&#39;dist traveled:&#39;, dist)</span>

        <span class="n">reaching_dest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">)</span>

        <span class="n">move</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_lats</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_lons</span><span class="p">(),</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">reaching_dest</span><span class="p">:</span>
            <span class="n">reached_final</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reaching final:&#39;</span><span class="p">,</span> <span class="n">reached_final</span><span class="p">)</span>

            <span class="n">new_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ncourses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">new_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ncourses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">reached_final</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_destination</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_last_step_dist</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_last_step_dist_to_dest</span> <span class="o">=</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">bool_arr_reached_final</span> <span class="o">=</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dist</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bool_arr_reached_final</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_arr_reached_final</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">move</span><span class="p">[</span><span class="s1">&#39;azi2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                        <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_lat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_lon</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">route_reached_waypoint</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">move</span><span class="p">[</span><span class="s1">&#39;azi2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;azi1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_lat</span>
                <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_lon</span>

        <span class="k">return</span> <span class="n">move</span></div>


<div class="viewcode-block" id="IsoBased.check_constraints">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_constraints">[docs]</a>
    <span class="k">def</span> <span class="nf">check_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move</span><span class="p">,</span> <span class="n">constraint_list</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">is_constrained</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
            <span class="n">form</span><span class="o">.</span><span class="n">print_step</span><span class="p">(</span><span class="s1">&#39;shape is_constraint before checking:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">is_constrained</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">is_constrained</span> <span class="o">=</span> <span class="n">constraint_list</span><span class="o">.</span><span class="n">safe_crossing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">],</span>
                                                       <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">is_constrained</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">):</span>
            <span class="n">form</span><span class="o">.</span><span class="n">print_step</span><span class="p">(</span><span class="s1">&#39;is_constrained after checking&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">is_constrained</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">is_constrained</span></div>


<div class="viewcode-block" id="IsoBased.update_position">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.update_position">[docs]</a>
    <span class="k">def</span> <span class="nf">update_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">move</span><span class="p">,</span> <span class="n">is_constrained</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">move</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">move</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">current_course</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">))</span>

        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path of this step&#39;</span> <span class="o">+</span>  <span class="c1"># str(move[&#39;lat1&#39;]) +</span>
                  <span class="c1"># str(move[&#39;lon1&#39;]) +</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">move</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">move</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dist_per_step&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>

        <span class="n">start_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">start_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">travel_dist</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">start_lats</span><span class="p">,</span> <span class="n">start_lons</span><span class="p">,</span> <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">],</span> <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">])</span>  <span class="c1"># calculate full distance</span>
        <span class="n">end_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">end_lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dist_to_dest</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">move</span><span class="p">[</span><span class="s1">&#39;lat2&#39;</span><span class="p">],</span> <span class="n">move</span><span class="p">[</span><span class="s1">&#39;lon2&#39;</span><span class="p">],</span> <span class="n">end_lats</span><span class="p">,</span> <span class="n">end_lons</span><span class="p">)</span>  <span class="c1"># calculate full distance</span>

        <span class="c1"># traveled, azimuth of gcr connecting start and new position</span>
        <span class="c1"># self.current_variant = gcrs[&#39;azi1&#39;]</span>
        <span class="c1"># self.current_azimuth = gcrs[&#39;azi1&#39;]</span>
        <span class="c1"># gcrs[&#39;s12&#39;][is_constrained] = 0</span>
        <span class="n">travel_dist</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">][</span><span class="n">is_constrained</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">concatenated_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">concatenated_distance</span><span class="p">[</span><span class="n">is_constrained</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimisation_criterion</span> <span class="o">==</span> <span class="s1">&#39;squareddist_over_disttodest&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="n">travel_dist</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">travel_dist</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dist_to_dest</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimisation_criterion</span> <span class="o">==</span> <span class="s1">&#39;dist&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="n">travel_dist</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span> <span class="o">=</span> <span class="n">travel_dist</span><span class="p">[</span><span class="s1">&#39;s12&#39;</span><span class="p">]</span>
        <span class="c1"># ToDo: use logger.debug and args.debug</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;full_dist_traveled:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_dist_traveled</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.update_fuel">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.update_fuel">[docs]</a>
    <span class="k">def</span> <span class="nf">update_fuel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_fuel</span><span class="p">,</span> <span class="n">fuel_rate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">set_fuel_rate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">fuel_rate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">get_fuel_rate</span><span class="p">())))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">delta_fuel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">))</span></div>


<div class="viewcode-block" id="IsoBased.get_delta_variables">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_delta_variables">[docs]</a>
    <span class="k">def</span> <span class="nf">get_delta_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boat</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="IsoBased.get_delta_variables_netCDF_last_step">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.get_delta_variables_netCDF_last_step">[docs]</a>
    <span class="k">def</span> <span class="nf">get_delta_variables_netCDF_last_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boat</span><span class="p">,</span> <span class="n">wind</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="IsoBased.init_fig">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.init_fig">[docs]</a>
    <span class="k">def</span> <span class="nf">init_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">water_depth</span><span class="p">,</span> <span class="n">map_size</span><span class="p">,</span> <span class="n">showDepth</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showDepth</span> <span class="o">=</span> <span class="n">showDepth</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">get_standard</span><span class="p">(</span><span class="s1">&#39;font_size&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">graphics</span><span class="o">.</span><span class="n">get_standard</span><span class="p">(</span><span class="s1">&#39;fig_size&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showDepth</span><span class="p">):</span>
            <span class="c1"># decrease resolution and extend of depth data to prevent memory issues when plotting</span>
            <span class="c1"># FIXME: double check boundary settings (set exact to trim for debugging)</span>
            <span class="n">ds_depth</span> <span class="o">=</span> <span class="n">water_depth</span><span class="o">.</span><span class="n">depth_data</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;trim&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">ds_depth_coarsened</span> <span class="o">=</span> <span class="n">ds_depth</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">ds_depth_coarsened</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="n">ds_depth_coarsened</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;</span> <span class="n">map_size</span><span class="o">.</span><span class="n">lat1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_depth_coarsened</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&lt;</span> <span class="n">map_size</span><span class="o">.</span><span class="n">lat2</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">ds_depth_coarsened</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&gt;</span> <span class="n">map_size</span><span class="o">.</span><span class="n">lon1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_depth_coarsened</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&lt;</span> <span class="n">map_size</span><span class="o">.</span><span class="n">lon2</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">ds_depth_coarsened</span><span class="o">.</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">generate_basemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">)</span>

        <span class="n">final_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="o">+</span> <span class="s1">&#39;/fig0.png&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save start figure to &#39;</span> <span class="o">+</span> <span class="n">final_path</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.update_fig">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.update_fig">[docs]</a>
    <span class="k">def</span> <span class="nf">update_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">graphics</span><span class="o">.</span><span class="n">generate_basemap</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">)</span>

        <span class="n">latitudes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">longitudes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">latitudes_T</span> <span class="o">=</span> <span class="n">latitudes</span><span class="o">.</span><span class="n">T</span>
        <span class="n">longitudes_T</span> <span class="o">=</span> <span class="n">longitudes</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># Plotting each route</span>
        <span class="k">for</span> <span class="n">lat_segment</span><span class="p">,</span> <span class="n">lon_segment</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latitudes_T</span><span class="p">,</span> <span class="n">longitudes_T</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lon_segment</span><span class="p">,</span> <span class="n">lat_segment</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
            <span class="c1"># fig.canvas.draw()</span>
            <span class="c1"># fig.canvas.flush_events()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pruning_error</span><span class="p">:</span>
            <span class="n">final_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="o">+</span> <span class="s1">&#39;/fig&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="n">status</span> <span class="o">+</span> <span class="s1">&#39;_error.png&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="o">+</span> <span class="s1">&#39;/fig&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="n">status</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Save updated figure to &#39;</span> <span class="o">+</span> <span class="n">final_path</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">final_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.expand_axis_for_intermediate">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.expand_axis_for_intermediate">[docs]</a>
    <span class="k">def</span> <span class="nf">expand_axis_for_intermediate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">course_per_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_per_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starttime_per_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shipparams_per_step</span><span class="o">.</span><span class="n">expand_axis_for_intermediate</span><span class="p">()</span></div>


<div class="viewcode-block" id="IsoBased.final_pruning">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.final_pruning">[docs]</a>
    <span class="k">def</span> <span class="nf">final_pruning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="IsoBased.update_dist">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.update_dist">[docs]</a>
    <span class="k">def</span> <span class="nf">update_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_time</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="IsoBased.check_for_positive_constraints">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_for_positive_constraints">[docs]</a>
    <span class="k">def</span> <span class="nf">check_for_positive_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint_list</span><span class="p">):</span>
        <span class="n">have_pos_points</span> <span class="o">=</span> <span class="n">constraint_list</span><span class="o">.</span><span class="n">have_positive</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">have_pos_points</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gcr_course_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gcr_course</span>
            <span class="k">return</span>

        <span class="n">constraint_list</span><span class="o">.</span><span class="n">init_positive_lists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span> <span class="o">=</span> <span class="n">constraint_list</span><span class="o">.</span><span class="n">get_current_destination</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span> <span class="o">=</span> <span class="n">constraint_list</span><span class="o">.</span><span class="n">get_current_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gcr_course_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_gcr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">degree</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Currently going from&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_temp</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;to&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">finish_temp</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.check_destination">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_destination">[docs]</a>
    <span class="k">def</span> <span class="nf">check_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">destination_lats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lats_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">destination_lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">arrived_at_destination</span> <span class="o">=</span> <span class="p">(</span><span class="n">destination_lats</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">destination_lons</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arrived_at_destination</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Did not arrive at destination! Need further routing steps or lower resolution.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IsoBased.check_positive_power">
<a class="viewcode-back" href="../../../source/api-documentation/WeatherRoutingTool.algorithms.html#WeatherRoutingTool.algorithms.isobased.IsoBased.check_positive_power">[docs]</a>
    <span class="k">def</span> <span class="nf">check_positive_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">negative_power</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolutefuel_per_step</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">negative_power</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Have negative values for power consumption. Needs to be checked!&#39;</span><span class="p">)</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">WeatherRoutingTool</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/algorithms/index.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/constraints/index.html">Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/consumption-models/index.html">Consumption models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/weather.html">Weather data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/api-documentation/index.html">API documentation (still under construction!)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/uml.html">UML Class diagrams</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, 52°North Spatial Information Research GmbH.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>